name: Weekly arXiv Summary

# 触发规则：每周日23点运行 + 手动触发
on:
  schedule:
    - cron: '0 15 * * 0'  # UTC时间15点 = 北京时间23点，每周日
  workflow_dispatch:  # 允许手动触发

jobs:
  generate-weekly-report:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 pandas openai python-dotenv

      - name: Generate weekly report
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          OPENAI_BASE_URL: ${{ secrets.OPENAI_BASE_URL }}
          CATEGORIES: ${{ vars.CATEGORIES }}
          LANGUAGE: ${{ vars.LANGUAGE }}
          MODEL_NAME: ${{ vars.MODEL_NAME }}
        run: |
          python weekly_generator.py

      - name: Commit and push files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'chore: update weekly report and papers'
          file_pattern: 'weekly_report.md weekly_papers.json'
          branch: main
